# LedEyesForFursuit——开源兽装电子发光眼
 Designed by [@FlyingMeow](https://space.bilibili.com/651746680), for electric eyes on fursuit

设计人：[@雪山飞喵ovo](https://space.bilibili.com/651746680)



## 项目简介

这个项目是给自家崽子搓的发光电子眼，最早从24年初开始做的，到现在（25年8月）差不多基本的功能都做完了ovo，打算开源出来，如果有感兴趣的小伙伴可以动手复刻，也可以再次基础之上共同做一些改进和尝试！请遵守[开源许可](##开源许可说明)，本方案在遵守该许可的前提下允许商用。

【展示图片&视频】



（目录）







### 项目背景

现有日系兽装发光眼方案主要有以下几种：

1. 冷光片方案



2. 遥控灯带方案



3. MCU+可编程灯珠方案



对于效果最好的“MCU+可编程灯珠方案”，目前还没有较为成熟的开源方案。

（一张图，3个方案成品截图  注明来源视频）



### 项目内容

为了克服现有方案缺点，同时设计一款较低成本的发光眼方案，决定采用ESP32+WS2812灯珠的方式实现可编程控制的发光眼，同时引入ADRPRO模块进行语音指令识别。

本方案的主要特点如下：

- 集成语音控制功能：
  
- 方便的多模式切换：
  

- 全灯珠可编程控制：
  



亮度上下渐变 眨眼睛



项目开源内容包括：

- 发光眼主控板及灯板的PCB设计（使用立创EDA专业版设计）
- 发光眼外壳的结构设计工程及模型文件（使用Solidworks设计）
- 发光眼的ESP32固件程序源码（使用VScode PlatformIO开发框架）
- ASRPRO语音识别程序的`.hd`文件（使用ASRPRO开发工具天问Bolck）





## 功能介绍

### 基本功能

1. 语音唤醒反馈：识别到唤醒词**飞喵飞喵**后，会眨一下眼睛作为反馈，同时板上LED7闪烁两次。
2. 眨眼睛效果：触发后，发光眼灯板的灯珠从上到下依次熄灭，再从下到上依次亮起，模拟“眨眼睛”的效果。
3. 呼吸灯效果：实现眼睛整体亮度渐亮、渐暗的呼吸灯效果。
4. 亮度调节：由语音指令或蓝牙指令调节发光眼整体亮度。
5. 颜色切换：自动切换眼睛颜色或由语音指令切换。
6. 模式切换：切换“蹦迪模式”、“舒缓模式”、“普通模式”，执行一组预设指令组合。
7. 风扇控制：通过语音指令控制内置风扇开关。

### 交互逻辑

各功能及模式切换可由**蓝牙串口指令**或**语音指令**进行控制：

- 蓝牙串口指令见 [附录1](##附录1 蓝牙交互指令汇总)
- 语音指令见 [附录2](##附录2 语音交互指令汇总)
- 蓝牙串口使用方法见 [附录3](##附录3 蓝牙串口使用方法)





## 硬件设计方案

### 电路设计



![逻辑框图-250725](https://gitee.com/FlyingMeow/mypic/raw/master/%E9%80%BB%E8%BE%91%E6%A1%86%E5%9B%BE-250725.png)





![供电框图-250725](https://gitee.com/FlyingMeow/mypic/raw/master/%E4%BE%9B%E7%94%B5%E6%A1%86%E5%9B%BE-250725.png)



### 结构设计





## 软件设计方案

### 程序架构



![软件流程图-250725](https://gitee.com/FlyingMeow/mypic/raw/master/%E8%BD%AF%E4%BB%B6%E6%B5%81%E7%A8%8B%E5%9B%BE-250725.png)





### 交互逻辑的实现



缺点：代码比较冗长



## 后续开发ideas

硬件设计方面：



软件功能方面：

- MPU6050
- 光敏电阻
- 手机端上位机
- 音频节奏识别
  - 输入音量饱和





## 开源许可说明





**【注意】**开源内容**不包括**演示使用的兽装角色形象设计，即**“雪山飞喵”**兽设形象的物种设定、造型设计、配色及花纹设计，其唯一所有者[@雪山飞喵ovo](https://space.bilibili.com/651746680)拥有该形象的著作权及使用权，任何未经授权的使用属于侵权行为。如果您想复刻本项目，请使用您的**原创**角色设定形象。





## 附录1 蓝牙交互指令汇总

（表格）



## 附录2 语音交互指令汇总

（表格）

【注】：ASRPRO目前暂不支持英文单词和字母的语音识别，仅限识别汉字。



## 附录3 蓝牙串口使用方法

1. 使用手机蓝牙查找发光眼设备并连接、配对



2. 使用蓝牙串口调试助手APP连接发光眼设备



3. 向发光眼设备下发蓝牙串口指令



## 程序开发日志

**==【注意！！！】烧录程序前根据硬件引脚检查宏定义==**

`2024-10-19 20:18` 整理程序思路：

`2024-10-26 21:37` 整理程序思路：

**LED颜色显示逻辑：**

![image-20241026213716994](https://gitee.com/FlyingMeow/mypic/raw/master/image-20241026213716994.png)





**主程序main：**

- 初始化、启用task
- 蓝牙串口消息处理



**taskEyesBlink：控制眨眼睛的task**



**taskEyesUpdate：控制LED显示刷新的task**



`2025-01-04`

语音识别功能测试



`2025-03-17`

功能实现待办

- 修改眨眼逻辑【已完成】
  - 增加触发变量`ledeyes.trigger_eyes_blink`
  - 使用该变量单次触发眨眼效果，再重新写线程触发flag
  - 模式：关闭眨眼 / 等时间间隔 / 伪随机时间间隔
  - `ledEyes.flag_eyes_blink`标志位的逻辑改到flag的触发线程



- 将ledeyes.color24_1 ~ ledeyes.color24_12 改为数组形式【已完成】
- 优化颜色数组取值



- 增加颜色的平滑切换效果、引出相关参数接口
  - 线性的平滑切换
  - 朝向目标点的速率随距离缓慢下降的平滑切换



- 增加自动颜色切换模式
  - 固定时间，刷新目标颜色值
  - 平滑切换速度放慢



- 补充蓝牙控制接口和语音接口的控制指令





`2025-03-30`

![image-20250330171709657](https://gitee.com/FlyingMeow/mypic/raw/master/image-20250330171709657.png)



颜色值：

50, 149, 183  *湖蓝色*

38, 122, 253

50, 0, 255

255, 0, 255

241, 97, 146

230, 57, 54

254, 90, 36

254, 168, 40

253, 239, 89

223, 233, 116

129, 203, 197

130, 223, 237



`2025-04-12`

蓝牙命令cs inv后颜色不切换的原因找到了：taskLedsColorShiftGradient中与taskLedsColorShift中使用里同一种标志变量做switch判断

修改：taskLedsColorShiftGradient常开



【问题】

- taskEyesUpdate与taskEyesBlink leds_l、leds_r的赋值有冲突，导致眨眼睛会闪（关闭眼睛渐变后十分明显） 如何协调这两个线程？
- 上面的解释图中taskLedsColorShift的解释有误
  - 需要重新整理现在的taskLedsColorShift与taskLedsColorShiftGradient的逻辑

- 偶尔突然闪一下，亮度特别高？



`2025-06-28`

![image-20250628222312532](https://gitee.com/FlyingMeow/mypic/raw/master/image-20250628222312532.png)





`2025-06-29`

功能更新ideas

- 增加蓝牙指令功能：控制颜色切换时间  ✓
- 增加功能：语音唤醒成功会眨眼  ✓
- 增加亮度时变的呼吸灯效果
  - 语音指令：控制开关
  - 蓝牙指令：控制开关、切换速度



`2025-07-02`

增加亮度时变的呼吸灯效果✓

增加蓝牙控制指令：

- 控制呼吸灯效果开关、速度



`2025-07-19`

蓝牙&语音控制指令测试
